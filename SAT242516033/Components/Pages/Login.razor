@page "/login"
@using System.ComponentModel.DataAnnotations
@using SAT242516033.Services

<PageTitle>Giriş</PageTitle>

<h3>Giriş</h3>

@if (!string.IsNullOrWhiteSpace(_message))
{
    <div class="alert alert-info">@_message</div>
}

<EditForm Model="_model" OnValidSubmit="OnSubmitAsync">
    <DataAnnotationsValidator />

    <div class="mb-3">
        <label class="form-label">Kullanıcı Adı</label>
        <InputText class="form-control" @bind-Value="_model.KullaniciAdi" />
    </div>

    <div class="mb-3">
        <label class="form-label">Şifre</label>
        <InputText class="form-control" type="password" @bind-Value="_model.Sifre" />
    </div>

    <button class="btn btn-primary" type="submit">Giriş Yap</button>
</EditForm>

@inject KullaniciAuthService KullaniciAuthService
@inject KullaniciSession KullaniciSession
@inject NavigationManager NavigationManager

@code {
    private LoginModel _model = new();
    private string? _message;

    private async Task OnSubmitAsync()
    {
        var kullanici = await KullaniciAuthService.TryLoginAsync(_model.KullaniciAdi, _model.Sifre);
        if (kullanici is null)
        {
            _message = "Kullanıcı bilgileri doğrulanamadı.";
            return;
        }

        KullaniciSession.Login(kullanici);
        _message = "Giriş başarılı.";
        NavigationManager.NavigateTo("/");
    }

    private class LoginModel
    {
        [Required]
        public string KullaniciAdi { get; set; } = string.Empty;

        [Required]
        public string Sifre { get; set; } = string.Empty;
    }
}
