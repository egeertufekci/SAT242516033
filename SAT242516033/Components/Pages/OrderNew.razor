@page "/orders/new"
@using SAT242516033.Components.Pages.Models
@inject Providers.IMyDbModel_Provider DbProvider

<PageTitle>New Order</PageTitle>

<h3>New Order</h3>

<div>
    <label>Product</label>
    <select @bind="order.ProductId">
        @foreach (var p in products)
        {
            <option value="@p.Id">@p.Name</option>
        }
    </select>
</div>
<div>
    <label>Quantity</label>
    <input type="number" @bind="order.Quantity" />
</div>
<div>
    <label>Status</label>
    <input @bind="order.Status" />
</div>
<button @onclick="Save">Create</button>
<button @onclick="Cancel">Cancel</button>

@code {
    private OrderDto order = new() { OrderDate = DateTime.Now, Quantity = 1, Status = "New" };
    private List<ProductDto> products = new();

    protected override async Task OnInitializedAsync()
    {
        products = (await DbProvider.GetItems<ProductDto>("usp_GetProducts")).ToList();
    }

    [Inject]
    public NavigationManager NavManager { get; set; } = default!;

    private async Task Save()
    {
        await DbProvider.SetItems<object>("usp_SaveOrder",
            ("Id", order.Id),
            ("ProductId", order.ProductId),
            ("Quantity", order.Quantity),
            ("Status", order.Status ?? string.Empty));
        NavManager.NavigateTo("/orders");
    }

    private void Cancel()
    {
        NavManager.NavigateTo("/orders");
    }
}